
首先我们看这个例子：

<img width="655" alt="image" src="https://github.com/Vuact/Blog/assets/74364990/0e4337a3-1bf9-4df9-891c-156bf8fb8d67">

<br>

打开这个 [sandbox](https://codesandbox.io/s/pjqnl16lm7) ， 你将看到同样的功能，ProfilePage组件 分别用 `类` 和 `函数式` 两种写法来实现。



代码如下：
```js
import ProfilePageFunction from './ProfilePageFunction';
import ProfilePageClass from './ProfilePageClass';

class App extends React.Component {
  state = {
    user: 'Dan',
  };
  render() {
    return (
      <>
        <label>
          <b>Choose profile to view: </b>
          <select
            value={this.state.user}
            onChange={e => this.setState({ user: e.target.value })}
          >
            <option value="Dan">Dan</option>
            <option value="Sophie">Sophie</option>
            <option value="Sunil">Sunil</option>
          </select>
        </label>
        <h1>Welcome to {this.state.user}’s profile!</h1>
        <p>
          <ProfilePageFunction user={this.state.user} /> (function)
        </p>
        <p>
          <ProfilePageClass user={this.state.user} /> (class)
        </p>
        <p>
          Can you spot the difference in the behavior?
        </p>
      </>
    )
  }
}
```
类的写法：ProfilePageClass
```js
class ProfilePage extends React.Component {
  showMessage = () => {
    alert('Followed ' + this.props.user);
  };

  handleClick = () => {
    setTimeout(this.showMessage, 3000);
  };

  render() {
    return <button onClick={this.handleClick}>Follow</button>;
  }
}
```
函数式写法：ProfilePageFunction
```js
function ProfilePage(props) {
  const showMessage = () => {
    alert('Followed ' + props.user);
  };

  const handleClick = () => {
    setTimeout(showMessage, 3000);
  };

  return (
    <button onClick={handleClick}>Follow</button>
  );
}
```

尝试按照以下顺序来分别使用这两个按钮：

1) `点击` 其中某一个 Follow 按钮。
2) 在`3秒`内 `切换` 选中的账号。
3) `查看` 弹出的文本。

你将看到一个奇特的区别:
- 当使用 函数式组件 实现的 ProfilePage, 当前账号是 Dan 时点击 Follow 按钮，然后立马切换当前账号到 Sophie，弹出的文本将依旧是 `Followed Dan`。
- 当使用 类组件 实现的 ProfilePage, 弹出的文本将是 `Followed Sophie`：
  <img width="655" alt="image" src="https://overreacted.io/386a449110202d5140d67336a0ade5a0/bug.gif">

--------
在这个例子中，第一个行为是正确的。如果我关注一个人，然后导航到了另一个人的账号，我的组件不应该混淆我关注了谁。 在这里，类组件的实现很明显是错误的。

--------

为什么我们的例子中类组件会有这样的表现？来仔细看看类组件中的 showMessage 方法：
<img width="1015" alt="image" src="https://github.com/Vuact/Blog/assets/74364990/caafcfbb-aa89-4586-83c1-4496963f2108">

这个类方法从 `this.props.user` 中读取数据。在 React 中 Props 是不可变的，所以他们永远不会改变。然而，`this`是，而且永远是，可变的。

事实上，这就是类组件 `this` 存在的意义。React本身会随着时间的推移而改变，以便你可以在渲染方法以及生命周期方法中得到最新的实例。

所以如果在请求已经发出的情况下我们的组件进行了重新渲染，`this.props`将会改变。`showMessage`方法从一个“过于新”的`props`中得到了`user`。


